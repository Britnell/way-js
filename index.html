<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite + TS</title>
    <script src="/way-loader.js"></script>
    <script type="module" src="/src/index.ts"></script>
    <link rel="stylesheet" href="/src/style.css" />

    <!-- code highlighting -->
    <script src="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/highlight.min.js"></script>
    <!-- theme -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/atom-one-dark.min.css"
    />
    <!-- <link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/github-dark.min.css"> -->
    <!-- <link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/stackoverflow-dark.min.css"> -->
    <!--  lang -->
    <!-- <script src="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/languages/javascript.min.js"></script> -->
    <!-- <script src="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/languages/xml.min.js"></script> -->
  </head>

  <script>
    window.pageprops = {
      version: "0.1.0",
      codex: {
        "counter-ex": `
      <!-- Html -->
      <div id="app">
        <x-counter></x-counter>
      </div>
      `,
        "form-ex": `
        <script>  
        // in module
        import * as v from "valibot";
        way.form(
          "login",
          {
            name: v.pipe(v.string(), v.minLength(1, "Name is required")),
            password: v.pipe(
              v.string(),
              v.minLength(4, "Password is too short"),
              v.maxLength(10, "Password is too long"),
              v.regex(/\d/, "Password must include at least one digit")
            ),
          },
          () => {
            const data = way.signal(null);
            const name = way.signal("");

            return {
              name,
              data,
              onsubmit: (ev: CustomEvent) => {
                console.log(ev.detail);
                data.value = ev.detail;
              },
            };
          }
        );
        <\/script>  
      
      `,
      },
    };
  </script>

  <body>
    <div id="app" x-load>
      <header class="content-grid">
        <div class="flex justify-between py-2">
          <span>Way js</span>
          <nav>
            <ul class="flex gap-4">
              <!-- TODO -->
              <!-- <li><a href="/guide" class="underline">Guide</a></li> -->
              <li><a href="demo" class="underline">Demos</a></li>
            </ul>
          </nav>
        </div>
      </header>

      <main class="content-grid">
        <div class="flex flex-col justify-center items-center my-10">
          <h1 class="text-5xl font-bold">Way js</h1>

          <h2 class="text-2xl">
            A
            <span class="line-through">javascript</span> Web framework
          </h2>
        </div>

        <div class="x">
          <div class="my-10" aria-label="diagram of 3 concentric circles">
            <div class="c-diag">
              <div class="c-circ a"></div>
              <div class="c-circ b"></div>
              <div class="c-circ c"></div>
            </div>
          </div>
          <h2 class="text-xl text-center">
            Html, Signals <br />
            & Web Components
          </h2>
        </div>

        <syn-tax
          class="breakout"
          x-props="{id:'counter-ex', language:'xml'}"
        ></syn-tax>

        <x-counter></x-counter>

        <div
          class="fullwidth my-18 py-12 text-center bg-white text-slate-800 font-sans"
        >
          <h2 class="text-5xl font-[900]">Look Mum, no jsx!</h2>
          <p class="text-3xl mt-6">and the build step is optional again</p>
        </div>

        <div class="x space-y-4">
          <p>
            I think these 3 go so well together. as minimal as possible with all
            the power of a full framework
          </p>

          <div class="flex gap-4 items-center">
            <svg
              class="flex-[0_0_100px]"
              width="80"
              height="80"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill="currentColor"
                d="M4 16v-2H2v2H1v-5h1v2h2v-2h1v5zm3 0v-4H5.6v-1h3.7v1H8v4zm3 0v-5h1l1.4 3.4h.1L14 11h1v5h-1v-3.1h-.1l-1.1 2.5h-.6l-1.1-2.5H11V16zm9 0h-3v-5h1v4h2zM9.4 4.2L7.1 6.5l2.3 2.3l-.6 1.2l-3.5-3.5L8.8 3zm1.2 4.6l2.3-2.3l-2.3-2.3l.6-1.2l3.5 3.5l-3.5 3.5z"
              />
            </svg>
            <div>
              <h2 class="text-xl font-bold mt-4">HTML first</h2>
              <p>
                Just write html again, no jsx, no vdom, what you see is what you
                get. the framework jsut attaches itself to the dom via custom
                <b> html attributes </b>. write vanilla html & js again, and
                work directly with the actual dom again.
              </p>
            </div>
          </div>

          <div class="flex gap-4 items-center">
            <svg
              class="flex-[0_0_100px]"
              width="80"
              height="80"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill="currentColor"
                d="m10 7.96l3.029-1.21l-7.5-3l-2.586 1.034a1.5 1.5 0 0 0-.364.208zM2.035 5.853A1.5 1.5 0 0 0 2 6.176v7.646a1.5 1.5 0 0 0 .943 1.393L8.7 17.518q.391.156.8.214V8.838zm8.465 11.88a3.5 3.5 0 0 0 .8-.214l5.757-2.303A1.5 1.5 0 0 0 18 13.822V6.176q0-.166-.035-.324L10.5 8.838zm6.921-12.74l-3.046 1.219l-7.5-3L8.7 2.48a3.5 3.5 0 0 1 2.6 0l5.757 2.303a1.5 1.5 0 0 1 .364.208"
              />
            </svg>
            <div>
              <h2 class="text-xl font-bold mt-4">Web Components</h2>
              <p>
                But we still want components, they are such a powerful way to
                composition your page or app. Write function components, and use
                them by their name like you would in jsx, web components already
                let us do that. Pass in props etc. just like in any js
                framework.
              </p>
            </div>
          </div>

          <div class="flex gap-4 items-center">
            <svg
              class="flex-[0_0_100px]"
              width="60"
              height="60"
              viewBox="0 0 32 32"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill="currentColor"
                d="M26 6a3.996 3.996 0 0 0-3.858 3H17.93A7.996 7.996 0 1 0 9 17.93v4.212a4 4 0 1 0 2 0v-4.211a7.95 7.95 0 0 0 3.898-1.62l3.669 3.67A3.95 3.95 0 0 0 18 22a4 4 0 1 0 4-4a3.95 3.95 0 0 0-2.019.567l-3.67-3.67A7.95 7.95 0 0 0 17.932 11h4.211A3.993 3.993 0 1 0 26 6M12 26a2 2 0 1 1-2-2a2 2 0 0 1 2 2m-2-10a6 6 0 1 1 6-6a6.007 6.007 0 0 1-6 6m14 6a2 2 0 1 1-2-2a2 2 0 0 1 2 2m2-10a2 2 0 1 1 2-2a2 2 0 0 1-2 2"
              />
            </svg>
            <div>
              <h2 class="text-xl font-bold mt-4">Signals</h2>
              <p>
                But web components alone don't have any reactivity. With signals
                we get fine grained reactivity, and can update just the relevant
                dom nodes and their attributes.
              </p>
            </div>
          </div>

          <div class="flex gap-4 items-center">
            <svg
              class="flex-[0_0_100px]"
              width="70"
              height="70"
              viewBox="0 0 2048 2048"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill="currentColor"
                d="M2048 640h-640V482L691 960l717 478v-158h640v640h-640v-328l-768-512v200H0V640h640v200l768-512V0h640zm-512 768v384h384v-384zM512 1152V768H128v384zM1536 128v384h384V128z"
              />
            </svg>
            <div>
              <h2 class="text-xl font-bold mt-4">DOM</h2>
              <p>
                all state is automatically available to all child nodes, just
                like css-variables, while custom events bubble up the dom tree.
                forget about prop drilling and passing callbacks around, use the
                DOM!
              </p>
            </div>
          </div>
        </div>

        <!-- basics -->
        <h2 class="text-2xl font-bold mb-4 mt-20">Basics</h2>
        <p>
          Define a component with `Way.comp('field',()=>{...})`, anything you
          return will be available in dynamic attributes in your html. <br />
          Attach it to any dom node with `x-comp="field"` and all children can
          now access the 'name' variable.
        </p>

        <syn-tax
          class="breakout"
          x-props="{id:'field', language:'xml'}"
        ></syn-tax>

        <div id="field" class="demo mb-12">
          <div x-comp="field">
            <input x-model="name" class="p-0.5 border" />
            <p x-show="name.value">
              Hi my name is: <br />
              "{name.value.toUpperCase()}"
            </p>
            <p x-else>please enter your name</p>
          </div>
          <script>
            way.comp("field", () => {
              const name = way.signal("foo");
              return { name };
            });
          </script>
        </div>

        <h2 class="text-2xl font-bold mb-4 mt-20">Props</h2>
        <p>
          Now we can build complex logic by passing signals between components
          as props. Let's reuse our counter component and use it for a countdown
        </p>

        <div class="x breakout">
          <syn-tax x-props="{id:'countdown'}"></syn-tax>
        </div>
        <div id="countdown" class="demo mb-12">
          <!-- html -->
          <div x-comp="x-counter">
            <p>
              Counter : {count}
              <button @click="count.value++" class="border ml-6">+1</button>
            </p>

            <count-down x-props="{start: count}"></count-down>
          </div>

          <!-- component -->
          <template id="count-down">
            <p>Countdown : {countdown}</p>
          </template>
          <script>
            way.comp("count-down", ({ props }) => {
              const countdown = way.signal(props.start?.value);
              let interval;

              way.effect(() => {
                countdown.value = props.start?.value;
                const runcountdown = () => {
                  if (countdown.value > 0) countdown.value -= 1;
                  else clearInterval(interval);
                };

                if (interval) clearInterval(interval);
                interval = setInterval(runcountdown, 300);
              });
              return { countdown };
            });
          </script>
        </div>

        <!-- forms -->
        <h2 class="text-2xl font-bold mb-4 mt-20">Forms</h2>
        <p>
          Input and form valdiation is one of the main reasons that client side
          interactivity is needed. So I wanted to build this right into the
          framework. <br />
          The error is automatically shown in the related aria-describedby
          element if there is one.
        </p>
        <p>
          Define a form with `way.form('login',...)`, apply it to any form
          element with `&lt;form x-form="login" >`
        </p>

        <syn-tax class="breakout" x-props="{id:'form-ex'}"></syn-tax>

        <div id="form-ex" class="demo">
          <!-- in html -->
          <form x-form="login" class="space-y-3" @onsubmit="onsubmit($event)">
            <label>
              Name:
              <input
                x-model="name"
                name="name"
                aria-describedby="nameerror"
                class="block border"
              />
            </label>
            <p id="nameerror" class="text-red-400"></p>

            <label>
              password:
              <input
                name="password"
                aria-describedby="passworderror"
                class="block border"
              />
            </label>
            <p id="passworderror" class="text-red-400"></p>
            <button>Submit</button>
            <p x-show="data.value">
              Hi {data.value.name} <br />
              secret: "{data.value.password}"
            </p>
          </form>
        </div>

        <!-- View transitions -->
        <h2 class="text-2xl font-bold mb-4 mt-20">Build smooth MPAs</h2>
        <p>
          With ViewTransitions coming to Firefox your MPA feels like an SPA.
          <br /><br />
          Make your routes even faster with new speculation rules and a polyfill
          - our extra library.
        </p>

        <!-- web compa -->
        <div
          class="fullwidth x my-16 bg-white text-slate-800 py-8 font-monocode"
        >
          <div class="flex flex-col items-center">
            <svg
              class=""
              width="80"
              height="80"
              viewBox="0 0 32 32"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill="currentColor"
                d="M30.47 9.14h-1.52v1.53H25.9V9.14h-1.52v1.53H7.62V9.14H6.09v1.53H3.05V9.14H1.52v3.05H0v7.62h1.52v3.05h1.53v-1.53h3.04v1.53h1.53v-1.53h16.76v1.53h1.52v-1.53h3.05v1.53h1.52v-3.05H32v-7.62h-1.53Zm-19.81 9.14H9.14v1.53H7.62v-1.53H6.09v1.53H4.57v-1.53H3.05v-4.57h1.52v4.57h1.52v-3.04h1.53v3.04h1.52v-4.57h1.52Zm9.15 0h-1.53v1.53h-1.52v-1.53h-1.52v1.53h-1.53v-1.53h-1.52v-4.57h1.52v4.57h1.53v-3.04h1.52v3.04h1.52v-4.57h1.53Zm9.14 0h-1.52v1.53H25.9v-1.53h-1.52v1.53h-1.53v-1.53h-1.52v-4.57h1.52v4.57h1.53v-3.04h1.52v3.04h1.53v-4.57h1.52Z"
              />
              <path
                fill="currentColor"
                d="M27.43 22.86h1.52v3.04h-1.52Zm0-16.77h1.52v3.05h-1.52ZM25.9 25.9h1.53v1.53H25.9Zm0-21.33h1.53v1.52H25.9Zm0 3.05V6.09h-4.57V4.57h-1.52v3.05h3.04v1.52h1.53V7.62zm-3.05 19.81h3.05v1.52h-3.05Z"
              />
              <path
                fill="currentColor"
                d="M22.85 24.38h-3.04v3.05h1.52V25.9h4.57v-1.52h-1.52v-1.52h-1.53zm0-21.33h3.05v1.52h-3.05Zm-3.04 25.9h3.04v1.53h-3.04Zm0-27.43h3.04v1.53h-3.04Zm-1.53 25.91h1.53v1.52h-1.53Zm0-24.38h1.53v1.52h-1.53Zm0 25.9h-1.52v1.53h-1.52v-1.53h-1.53v1.53h-1.52V32h7.62v-1.52h-1.53zM12.19 7.62h7.62v1.52h-7.62Zm0 15.24h7.62v1.52h-7.62Zm1.52-19.81h1.53V1.52h1.52v1.53h1.52V1.52h1.53V0h-7.62v1.52h1.52zm-1.52 24.38h1.52v1.52h-1.52Zm0-24.38h1.52v1.52h-1.52Zm-3.05 25.9h3.05v1.53H9.14Zm0-27.43h3.05v1.53H9.14ZM6.09 27.43h3.05v1.52H6.09Z"
              />
              <path
                fill="currentColor"
                d="M9.14 7.62h3.05V4.57h-1.53v1.52H6.09v1.53h1.53v1.52h1.52zM6.09 3.05h3.05v1.52H6.09Zm0 21.33v1.52h4.57v1.53h1.53v-3.05H9.14v-1.52H7.62v1.52zM4.57 25.9h1.52v1.53H4.57Zm0-21.33h1.52v1.52H4.57ZM3.05 22.86h1.52v3.04H3.05Zm0-16.77h1.52v3.05H3.05Z"
              />
            </svg>
            <h2 class="my-4 text-center text-2xl font-bold">
              Web platform & html first
            </h2>

            <p class="text-lg font-normal">
              Frameworks should be compatible with html, vanilla js &
              web-components, so we can stop vendor lock-in. You shouldn't be
              stuck with a framework because of a component library.
              <br /><br />
              All libraries should be compatible with your stack, why are we
              rebuilding the same features in each framework?
            </p>
          </div>
        </div>

        <!-- Main -->
      </main>

      <footer>
        <p class="x font-monocode">Version {version}</p>
      </footer>
    </div>

    <!-- ###################################################################### -->

    <div id="counter-ex">
      <!-- Component Template -->
      <template id="x-counter">
        <div class="demo flex flex-col items-center space-y-3">
          <p>the count is : {count}</p>
          <button class="button" @click="incr()">+1</button>
          <p>{count} x 2 = {double}</p>
        </div>
      </template>

      <!-- Component Logic -->
      <script>
        way.comp("x-counter", () => {
          const count = way.signal(1);
          const incr = () => (count.value += 1);
          const double = way.computed(() => count.value * 2);
          way.effect(() => {
            console.log(`> the count is now ${count.value}`);
          });
          return { count, double, incr };
        });
      </script>
    </div>

    <template id="syn-tax">
      <pre>
      <code :class="language ? `language-${language}` : ''">
        {codex?.[id] ?? ''}
        {text}
      </code>
    </pre>
    </template>
    <script>
      way.comp("syn-tax", ({ props }) => {
        const id = props.id;
        const el = document.getElementById(id);
        const text = el.innerHTML.trim();
        return { text, ...props };
      });
    </script>

    <template id="card">
      <div style="border: 1px solid #ccc; padding: 16px; margin: 16px 0">
        <h3>Card</h3>
        <slot></slot>
      </div>
    </template>

    <style>
      [x-load] {
        display: none;
      }
    </style>
    <script>
      hljs.highlightAll();
    </script>
  </body>
</html>
